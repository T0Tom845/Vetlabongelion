<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      lang="ru">
<head>
    <title>Список клиентов</title>
    <link rel="stylesheet" type="text/css" th:href="@{/styles/css/style.css}"/>
</head>
<body>
<div th:insert="~{fragments/general/header :: header}"></div>
<h1>Список клиентов</h1>
<div class="add-client"><a class="btn" onclick="openAddClientForm()">Добавить пользователя</a></div>
<div class="table-header">
    <h2>ID</h2>
    <h2>ФИО</h2>
    <h2>Компания</h2>
    <h2>Действие</h2>
</div>
<th:block th:each="client : ${clients}">
    <form class="table-row" th:id="'client-form-' + ${client.id}" th:action="@{/clients/editClient/{id}(id=${client.id})}" method="post">
        <div class="client-id" th:text="${client.id}"></div>
        <input type="text" readonly="true" required name="name"  class="client-data" th:value="${client.name}">
        <input type="text" readonly="true" required name="company" class="client-data" th:value="${client.company}">
        <div class="actions">
            <button type="button" class="btn change-button" onclick="enableEditForm(event)" th:text="Изменить"></button>
            <button type="submit" disabled class="btn submit-button" th:text="Сохранить"></button>
            <button formmethod="get" th:formaction="@{/clients/deleteClient/{id}(id=${client.id})}" type="submit"
                    class="btn">Удалить
            </button>
        </div>
    </form>

</th:block>
</div>

<div id="add-client-form" class="form-popup-wrapper"
     th:insert="~{fragments/clients/add-client-popup}"></div>

</body>
<script type="text/javascript">
    function openAddClientForm() {
        document.getElementById("add-client-form").style.display = "block";
    }
    function enableEditForm(event){
        let form = event.target.closest('form');
        let dataArr = form.getElementsByClassName('client-data');
        for (let data of dataArr) {
            data.removeAttribute('readonly');
        }

        let submitButton = form.querySelector('.submit-button');
        submitButton.removeAttribute('disabled');

        let changeButton = form.querySelector('.change-button');
        changeButton.setAttribute('disabled', 'true');

    }

</script>
</html>